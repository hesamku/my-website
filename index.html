<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>HESAM License Manager</title>
<style>
body { font-family: Arial; background:#111; color:#fff; padding:20px; max-width:600px; margin:auto;}
h1 { text-align:center; color:#3e8af2; }
.box { background:#222; padding:20px; border-radius:10px; margin-bottom:20px;}
input { width:100%; padding:10px; margin-top:8px; border-radius:6px; border:none; outline:none;}
button { width:100%; padding:12px; margin-top:10px; background:#3e8af2; border:none; border-radius:6px; color:#fff; font-size:16px; cursor:pointer;}
button:hover { background:#1e5fcc;}
pre { background:#000; padding:10px; border-radius:6px; overflow-x:auto;}
label { color:#bbb; font-size:14px;}
</style>
</head>
<body>

<h1>ğŸ”‘ HESAM License Manager</h1>

<!-- Login -->
<div class="box" id="loginBox">
  <h3>ÙˆØ±ÙˆØ¯</h3>
  <input id="username" placeholder="Username">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<!-- Main -->
<div class="box" id="mainBox" style="display:none;">
  
  <h3>ğŸ“Œ Ø³Ø§Ø®Øª Ù„Ø§ÛŒØ³Ù†Ø³ Ø¬Ø¯ÛŒØ¯</h3>
  <input id="newKey" placeholder="Ú©Ù„ÛŒØ¯ Ù„Ø§ÛŒØ³Ù†Ø³ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)">
  <label>Ú†Ù†Ø¯ Ø±ÙˆØ²ØŸ</label>
  <input id="newDays" type="number" value="30">
  <button onclick="createLicense()">Ø³Ø§Ø®Øª Ù„Ø§ÛŒØ³Ù†Ø³</button>

  <h3>ğŸ“Œ ØªÙ…Ø¯ÛŒØ¯ Ù„Ø§ÛŒØ³Ù†Ø³</h3>
  <input id="extendKey" placeholder="Ú©Ù„ÛŒØ¯ Ù„Ø§ÛŒØ³Ù†Ø³">
  <label>Ú†Ù†Ø¯ Ø±ÙˆØ² Ø§Ø¶Ø§ÙÙ‡ Ø´ÙˆØ¯ØŸ</label>
  <input id="extendDays" type="number" value="30">
  <button onclick="extendLicense()">ØªÙ…Ø¯ÛŒØ¯ Ù„Ø§ÛŒØ³Ù†Ø³</button>

  <pre id="result"></pre>
</div>

<script>
// GitHub
const TOKEN = "YOUR_GITHUB_TOKEN";   // ØªÙˆÚ©Ù† Ø´Ù…Ø§
const USER  = "hesamku";
const REPO  = "my-website";
const FILE  = "keys.json";

// Login
function login(){
    if(document.getElementById("username").value==="1234" &&
       document.getElementById("password").value==="1234"){
        document.getElementById("loginBox").style.display="none";
        document.getElementById("mainBox").style.display="block";
    } else alert("âŒ Ø§Ø´ØªØ¨Ø§Ù‡Ù‡");
}

// JSON local
let keysJSON = { "keys": {} };

// Ø³Ø§Ø®Øª Ú©Ù„ÛŒØ¯ ØªØµØ§Ø¯ÙÛŒ
function generateKey(){
    const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
    let key = "HESAM-KU-VIP-";
    for(let i=0;i<9;i++) key += chars[Math.floor(Math.random()*chars.length)];
    return key;
}

// Ù†Ù…Ø§ÛŒØ´ Ø®Ø±ÙˆØ¬ÛŒ
function showResult(msg){ document.getElementById("result").innerText = msg; }

// Ø³Ø§Ø®Øª Ù„Ø§ÛŒØ³Ù†Ø³
async function createLicense(){
    let key = document.getElementById("newKey").value.trim() || generateKey();
    let days = parseInt(document.getElementById("newDays").value);
    
    let expires = new Date();
    expires.setDate(expires.getDate() + days);
    let expStr = expires.toISOString().slice(0,10);
    
    keysJSON.keys[key] = { status:"active", expires:expStr };
    showResult("âœ” Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯:\n" + JSON.stringify(keysJSON.keys[key], null, 2));
    
    await updateGitHub();
}

// ØªÙ…Ø¯ÛŒØ¯ Ù„Ø§ÛŒØ³Ù†Ø³
async function extendLicense(){
    let key = document.getElementById("extendKey").value.trim();
    let days = parseInt(document.getElementById("extendDays").value);

    if(!keysJSON.keys[key]) return showResult("âŒ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯");

    let expires = new Date();
    expires.setDate(expires.getDate() + days);
    let expStr = expires.toISOString().slice(0,10);

    keysJSON.keys[key].expires = expStr;
    showResult("âœ” ØªÙ…Ø¯ÛŒØ¯ Ø´Ø¯:\n" + JSON.stringify(keysJSON.keys[key], null, 2));

    await updateGitHub();
}

// Ø¢Ù¾Ø¯ÛŒØª GitHub
async function updateGitHub(){
    try{
        const fileRes = await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/${FILE}`);
        const file = await fileRes.json();

        await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/${FILE}`, {
            method:"PUT",
            headers:{
                "Authorization":`token ${TOKEN}`,
                "Content-Type":"application/json"
            },
            body: JSON.stringify({
                message:"License update",
                content: btoa(unescape(encodeURIComponent(JSON.stringify(keysJSON, null, 2)))),
                sha: file.sha
            })
        });

        showResult("âœ” ÙØ§ÛŒÙ„ keys.json Ø¢Ù¾Ø¯ÛŒØª Ø´Ø¯");
    }catch(e){
        showResult("âŒ Ø®Ø·Ø§:\n" + e);
    }
}
</script>
</body>
</html>
